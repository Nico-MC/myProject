<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>    <title>myproject</title>
    <!-- CSS -->
    <!-- <link href="https://fonts.googleapis.com/css?family=Skranji:700" rel="stylesheet"-->
    <link rel="stylesheet" type="text/css" href="assets/css/page.css">
    <link rel="stylesheet" type="text/css" href="assets/css/game.css">
    <link rel="stylesheet" type="text/css" href="assets/css/auctionhouse.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- DATABASE -->
    <!-- <script src="https://www.baqend.com/js-sdk/latest/baqend.min.js"></script> -->
    <script type="text/javascript" src="//www.baqend.com/js-sdk/latest/baqend-realtime.js"></script>
    <!-- MODULES -->
    <script type="text/javascript" src="modules/phaser.min.js"></script>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
  </head>
  <body>
    <section></section>

    <script type="text/javascript" src="js/db_baqend.js"></script>
    <script type="text/javascript">

      // Load mit Vorsicht genie√üen, da asynchron.
      function transferToLogin(sk) {
        console.log(DB.User.me.securitykey == sk);
        if(DB.User.me.securitykey == sk) {
          $.when( $('section .register_container').fadeOut("slow") ).done(function() {
            $('section').load('assets/content/content.html .login_content', function() {
              DB.User.find(DB.User.me.id).singleResult({depth: 2}, function(user) {
                if(user.items.itemlist.length == 0) {
                  $('.inventar_div').html('<span class="no_items">Keine Items vorhanden.</span>');
                } else {
                  var items = user.items.itemlist;
                  items.forEach(function(item) {
                    if(item.name == "gold") {
                      $('.inventar_div').append('<div class="inventar_item gold"></div>');
                    } else if(item.name == "iron") {
                      $('.inventar_div').append('<div class="inventar_item iron"></div>');
                    }
                  });
                  $('.inventar_item').click(function(e) {
                    var target = e.target;
                    console.log(target);
                  });
                }
              });
              startGame();
            });
          });
        }
      }

      function transferToRegister() {
        $('section').load('assets/content/content.html .register_container', function() {
          $('.register_div').fadeIn(2000);
          // Click on register-button
          $("#register").submit(function(event) {
            event.preventDefault();
            register($(this).serializeArray(), function(sk) {
              transferToLogin(sk);
            });
          });
          // Click on login-button
          $("#login").submit(function(event) {
            event.preventDefault();
            login($(this).serializeArray(), function(sk) {
              transferToLogin(sk);
            });
          });
        });
      }

      function errormessage(message) {
        $('.alert').css('color', '#721c24');
        $('.alert').css('background-color', '#f8d7da');
        $('.alert').css('border-color', '#f5c6cb');
        $('.alert').html(message);
        $('.alert').toggle("slow").delay(2000).toggle("slow");
      }

      function registermessage(callback) {
        $('.alert').css('color', '#21721c');
        $('.alert').css('background-color', '#d8f8d7');
        $('.alert').css('border-color', '#c6f5c6');
        $('.alert').html("Registrierung erfolgreich!");
        $('.alert').slideDown("slow").delay(500, function() {
          return callback();
        });
      }

      function switchRegister() {
        if($('.register_div #register').css('display') != 'none') {
          $('.register_div #register').slideUp("slow", function() {
            $('.register_div #login').slideDown("slow");
          });
        } else {
          $('.register_div #login').slideUp("slow", function() {
            $('.register_div #register').slideDown("slow");
          });
        }
      }

      function toggleDatabaseButton() {
        if($('.simulate_button_gradient').css('display') == 'none') $('.simulate_button_gradient').fadeIn("slow");
        else $('.simulate_button_gradient').fadeOut("slow");
      }

      $('#search').submit(function(e) {
        e.preventDefault();
        search_result = $('#search_field').val();
        search(search_result);
      });

      // Clear text search_field
      $("#search_field").val("");

      $(window).resize(function() {
        resize();
      });

      function resize(obj) {
        if(obj != null) {
          console.log("This");
          var target = $(obj).attr("href");
          var oldHeight = $('.tab-pane.active').height();
          var newHeight = $(target).height();
          $(target).height(oldHeight);

          setTimeout(function() {
            $(".tab-pane.active").height(newHeight);
          }, 300);
        } else {
          if($('#tab3.tab-pane.active').length !== 0) {
            var overflowHeight = $('.tab-pane.active .overflow_div').outerHeight();
            var tabHeight = $('.tab-pane.active').height();
            console.log(overflowHeight + " ----- " + tabHeight);
            if(overflowHeight > tabHeight) {
              $(".tab-pane.active").height($('.tab-pane.active .overflow_div').outerHeight());
            } else if(overflowHeight < tabHeight) {
              $(".tab-pane.active").height($('.tab-pane.active .overflow_div').outerHeight());
            }
          }
        }
      }
    </script>

    <!-- LOADING GAME -->
    <script type="text/javascript" src="js/states/Boot.js"></script>
    <script type="text/javascript" src="js/states/Preload.js"></script>
    <script type="text/javascript" src="js/states/Menu.js"></script>
    <script type="text/javascript" src="js/states/game/Game.js"></script>
    <script type="text/javascript" src="js/states/game/Movement.js"></script>
    <script type="text/javascript" src="js/states/game/Ui.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
  </body>
</html>
